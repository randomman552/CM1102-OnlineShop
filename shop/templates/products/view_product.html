{% extends 'layout.html' %}
{% from 'products/review.html' import rating %}

{% block head %}
    <title>{{ product.name }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/view_product.css')}}">
    <script defer type="text/javascript" src="{{ url_for('static', filename='js/slideshow.js') }}"></script>
    <script defer type="text/javascript" src="{{ url_for('static', filename='js/product-edit.js') }}"></script>
{% endblock %}

{% block content %}
    {% if product != None %}
        <div class="product main_container">
            <h1>{{ product.name }}</h1>
            <div class="product row">
                <div class="product image" onmouseover="slideShowControlsState(true)" onmouseout="slideShowControlsState(false)">
                    <div class="product image container">
                        {# Picture slideshow #}
                        {% if pictures|length > 0 -%}
                            {% for picture in pictures %}
                                <div class="slide-content">
                                    <img src="{{ url_for( 'static', filename=picture.URL) }}" alt="Product Image" onmouseover="slideShowPause()" onmouseout="slideShowResume()">
                                </div>
                            {% endfor %}
                        {%- else -%}
                            <div class="slide-content">
                                <img src="{{ url_for('static', filename='products/default.png') }}" alt="No images" onmouseover="slideShowPause()" onmouseout="slideShowResume()">
                            </div>
                        {%- endif %}
                        <a id="slideshow-prev" class="prev" onclick="slideMov(-1)">&#10094;</a>
                        <a id="slideshow-next" class="next" onclick="slideMov(1)">&#10095;</a>
                    </div>
                    <div class="product image selector">
                        {% for i in range(pictures|length) %}
                            <div class="slide-selector">
                                <img src="{{ url_for( 'static', filename=pictures[i].URL) }}" alt="Thumbnail">
                                <div onclick="slideJmp({{i}})" class="slide-selector overlay"></div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
                <div class="product description container">
                    <h2>description</h2>
                    <div class="product description text">
                        <span id="description">{{ product.description }}</span>
                    </div>
                </div>
                <div class="product purchase">
                    {%- set overview = product.information["overview"] -%}
                    {% if overview|length > 0 -%}
                        <h2>overview</h2>
                        <ul>
                            {% for item in overview -%}
                                <li>{{- item -}}</li>
                            {%- endfor %}
                        </ul>
                        <hr>
                    {%- endif %}
                    <h2>purchase</h2>
                    <div class="product price">
                        <span id="price" style="width: 100%;">{{ product.price }}</span>
                    </div>
                    <div class="product rating">
                        {{ rating(review_avg, review_count) }}
                    </div>
                    <button class="green-confirm">
                        Add to cart
                    </button>
                    <button>
                        Add to wishlist
                    </button>
                </div>
            </div>
            <h2 id="reviews">reviews</h2>
            <div class="review-container">
                {# TODO: Add review sorting/filtering #}
                {# For each review, add the review to the DOM #}
                {% for i in range(reviews|length) %}
                    <div class="review">
                        <div>
                            {%- if users[i] -%}
                                {{ users[i].email }}
                            {%- else -%}
                                Anonymous
                            {%- endif %}
                            {{ rating(reviews[i].rating) }}
                        </div>
                        {% if reviews[i].content %}
                            <div class="content">
                                {{ reviews[i].content }}
                            </div>
                        {% else %}
                            <div class="content emtpy">
                                User left no comment.
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        </div>
    {% else %}
        <h1>The requested product does not exist.</h1>
    {% endif %}
{% endblock %}